/**
 * @fileoverview Rule to enforce a particular function style
 * @author Nicholas C. Zakas
 */
"use strict";

//------------------------------------------------------------------------------
// Rule Definition
//------------------------------------------------------------------------------

<<<<<<< HEAD
=======
<<<<<<< HEAD
/** @type {import('../shared/types').Rule} */
=======
>>>>>>> 421bc8df ( Fix: configuration files)
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
module.exports = {
    meta: {
        type: "suggestion",

        docs: {
<<<<<<< HEAD
=======
<<<<<<< HEAD
            description: "Enforce the consistent use of either `function` declarations or expressions assigned to variables",
            recommended: false,
            url: "https://eslint.org/docs/latest/rules/func-style"
=======
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
            description: "enforce the consistent use of either `function` declarations or expressions",
            category: "Stylistic Issues",
            recommended: false,
            url: "https://eslint.org/docs/rules/func-style"
<<<<<<< HEAD
=======
>>>>>>> 421bc8df ( Fix: configuration files)
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
        },

        schema: [
            {
                enum: ["declaration", "expression"]
            },
            {
                type: "object",
                properties: {
                    allowArrowFunctions: {
                        type: "boolean",
                        default: false
<<<<<<< HEAD
=======
<<<<<<< HEAD
                    },
                    overrides: {
                        type: "object",
                        properties: {
                            namedExports: {
                                enum: ["declaration", "expression", "ignore"]
                            }
                        },
                        additionalProperties: false
=======
>>>>>>> 421bc8df ( Fix: configuration files)
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
                    }
                },
                additionalProperties: false
            }
        ],

        messages: {
            expression: "Expected a function expression.",
            declaration: "Expected a function declaration."
        }
    },

    create(context) {

        const style = context.options[0],
            allowArrowFunctions = context.options[1] && context.options[1].allowArrowFunctions,
            enforceDeclarations = (style === "declaration"),
<<<<<<< HEAD
=======
<<<<<<< HEAD
            exportFunctionStyle = context.options[1] && context.options[1].overrides && context.options[1].overrides.namedExports,
=======
>>>>>>> 421bc8df ( Fix: configuration files)
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
            stack = [];

        const nodesToCheck = {
            FunctionDeclaration(node) {
                stack.push(false);

<<<<<<< HEAD
                if (!enforceDeclarations && node.parent.type !== "ExportDefaultDeclaration") {
=======
<<<<<<< HEAD
                if (
                    !enforceDeclarations &&
                    node.parent.type !== "ExportDefaultDeclaration" &&
                    (typeof exportFunctionStyle === "undefined" || node.parent.type !== "ExportNamedDeclaration")
                ) {
                    context.report({ node, messageId: "expression" });
                }

                if (node.parent.type === "ExportNamedDeclaration" && exportFunctionStyle === "expression") {
=======
                if (!enforceDeclarations && node.parent.type !== "ExportDefaultDeclaration") {
>>>>>>> 421bc8df ( Fix: configuration files)
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
                    context.report({ node, messageId: "expression" });
                }
            },
            "FunctionDeclaration:exit"() {
                stack.pop();
            },

            FunctionExpression(node) {
                stack.push(false);

<<<<<<< HEAD
                if (enforceDeclarations && node.parent.type === "VariableDeclarator") {
=======
<<<<<<< HEAD
                if (
                    enforceDeclarations &&
                    node.parent.type === "VariableDeclarator" &&
                    (typeof exportFunctionStyle === "undefined" || node.parent.parent.parent.type !== "ExportNamedDeclaration")
                ) {
                    context.report({ node: node.parent, messageId: "declaration" });
                }

                if (
                    node.parent.type === "VariableDeclarator" && node.parent.parent.parent.type === "ExportNamedDeclaration" &&
                    exportFunctionStyle === "declaration"
                ) {
=======
                if (enforceDeclarations && node.parent.type === "VariableDeclarator") {
>>>>>>> 421bc8df ( Fix: configuration files)
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
                    context.report({ node: node.parent, messageId: "declaration" });
                }
            },
            "FunctionExpression:exit"() {
                stack.pop();
            },

<<<<<<< HEAD
            ThisExpression() {
=======
<<<<<<< HEAD
            "ThisExpression, Super"() {
=======
            ThisExpression() {
>>>>>>> 421bc8df ( Fix: configuration files)
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
                if (stack.length > 0) {
                    stack[stack.length - 1] = true;
                }
            }
        };

        if (!allowArrowFunctions) {
            nodesToCheck.ArrowFunctionExpression = function() {
                stack.push(false);
            };

            nodesToCheck["ArrowFunctionExpression:exit"] = function(node) {
<<<<<<< HEAD
=======
<<<<<<< HEAD
                const hasThisOrSuperExpr = stack.pop();

                if (!hasThisOrSuperExpr && node.parent.type === "VariableDeclarator") {
                    if (
                        enforceDeclarations &&
                        (typeof exportFunctionStyle === "undefined" || node.parent.parent.parent.type !== "ExportNamedDeclaration")
                    ) {
                        context.report({ node: node.parent, messageId: "declaration" });
                    }

                    if (node.parent.parent.parent.type === "ExportNamedDeclaration" && exportFunctionStyle === "declaration") {
                        context.report({ node: node.parent, messageId: "declaration" });
                    }
=======
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
                const hasThisExpr = stack.pop();

                if (enforceDeclarations && !hasThisExpr && node.parent.type === "VariableDeclarator") {
                    context.report({ node: node.parent, messageId: "declaration" });
<<<<<<< HEAD
=======
>>>>>>> 421bc8df ( Fix: configuration files)
>>>>>>> c36f9991e2dbbd453d7a1e0d08a2e99a3685e7b0
                }
            };
        }

        return nodesToCheck;

    }
};
